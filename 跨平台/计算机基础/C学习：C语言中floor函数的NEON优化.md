
**ç›®å½•**
[toc]

æ ‡é¢˜ï¼šCå­¦ä¹ ï¼šCè¯­è¨€ä¸­floorå‡½æ•°çš„NEONä¼˜åŒ–

## ä¸¾ä¾‹è¯´æ˜
----
å‡è®¾å·²æœ‰floatç±»å‹çš„å¤§æ•°ç»„`x[10000]`å’Œfloatç±»å‹çš„`y[10000]`ï¼Œå°†`x[i]`ä»¥å‘ä¸‹å–æ•´çš„æ–¹å¼è½¬ä¸ºéƒ½æ˜¯æ•´æ•°çš„floatç±»å‹æ•°ç»„ï¼Œç»“æœæ”¾åœ¨`y[i]`æ•°ç»„é‡Œã€‚

`ceil/floor/round/int` **å‚»å‚»åˆ†ä¸æ¸…æ¥šï¼Ÿ** å…ˆæŠŠæµ®ç‚¹å–æ•´å‡½æ•°æ¢³ç†å¦‚ä¸‹è¡¨ï¼š
| å‡½æ•°å | ç¬¦å· |      åŠŸèƒ½      |                       ä¸¾ä¾‹                       |
| :----: | ---- | :------------: | :----------------------------------------------: |
|  ceil  | âŒˆğ‘¦âŒ‰  |    å‘ä¸Šå–æ•´    |     æ­£æ•°ï¼š(4, 5] -> 5ï¼›è´Ÿæ•°ï¼š(-6, -5] -> -5      |
| floor  | âŒŠğ‘¦âŒ‹  |    å‘ä¸‹å–æ•´    |     æ­£æ•°ï¼š[5, 6) -> 5ï¼›è´Ÿæ•°ï¼š[-5, -4) -> -5      |
| round  | âŒŠğ‘¦âŒ‰  | åœ†æ•´ï¼Œå››èˆäº”å…¥ | æ­£æ•°ï¼š[4.5, 5.5) -> 5ï¼›è´Ÿæ•°ï¼š (-5.5, -4.5] -> -5 |
|  int   | NA   |      æˆªæ–­      |     æ­£æ•°ï¼š[5, 6) -> 5ï¼›è´Ÿæ•°ï¼š(-6, -5] -> -5      |

## æ€è·¯åˆ†æ
---
ä»ä¸Šè¡¨ä¸­å¯ä»¥çœ‹å‡ºï¼Œfloorå‡½æ•°çš„ç‰¹æ€§å°±æ˜¯ï¼Œéè´Ÿæ•°æ—¶ç­‰ä»·äºæˆªæ–­åŠŸèƒ½ï¼Œè´Ÿæ•°æ—¶è‹¥ä¸æ˜¯æ•´æ•°åˆ™å‡ä¸€å†æˆªæ–­ï¼Œè‹¥**æ˜¯è´Ÿæ•´æ•°åˆ™ç­‰äºè‡ªèº«**ã€‚æˆ‘ä»¬å®¹æ˜“å‘ç°ï¼Œfloorå‡½æ•°å¤„ç†å‰åä¸¤æ•°é—´è·ä¸å¯èƒ½`>=1`ï¼Œä½œä¸ºå¤„ç†ç‰¹æ®Šæƒ…å†µè´Ÿæ•´æ•°çš„ä¾æ®ã€‚

äºæ˜¯æœ‰ä»¥ä¸‹æ€è·¯ï¼š
 - å…ˆåˆ¤æ–­æ˜¯å¦ä¸ºè´Ÿæ•°
 - è‹¥ä¸ºéè´Ÿæ•°ï¼Œåˆ™ç›´æ¥æˆªæ–­
 - è‹¥ä¸ºè´Ÿæ•°ï¼Œåˆ™ç»Ÿä¸€éƒ½å‡ä¸€åå†æˆªæ–­
 - å¤„ç†ç‰¹æ®Šæƒ…å†µï¼šè´Ÿæ•´æ•°ä¸ºå…¶æœ¬èº«
 	- å½“å‰ç»“æœç»Ÿä¸€åŠ 1ï¼Œä¸åˆå§‹floatæ•°æ®æ¯”è¾ƒ
 	- è‹¥åˆå§‹æ•°æ®å¤§äºç­‰äºå½“å‰ç»“æœï¼Œåˆ™è¯´æ˜å½“å‰é—´è·`>=1`ï¼Œè¯¥å€¼ä¸ºè´Ÿæ•´æ•°ï¼Œéœ€æ¢ä¸ºåˆå§‹æ•°æ®

> æ³¨æ„ï¼Œè¯¥æ€è·¯åŒæ ·ä¹Ÿå¯ä»¥æ¨å¹¿åˆ°ceilå’Œroundå‡½æ•°çš„ä¼˜åŒ–ã€‚ceilå¤„ç†å‰åæ•°æ®é—´è·å°äº1ï¼Œroundå‡½æ•°å¤„ç†åæ•°æ®é—´è·ä¸è¶…è¿‡0.5ã€‚

## ä»£ç å®ç°
---
**åŸå‡½æ•°ï¼š**

```c
#include <math.h>

int i;
for (i = 0; i < 10000; i++)
{
	y[i] = (int)floor(x[i]);
}
```

**ä¼˜åŒ–åï¼š**

```c
#include <math.h>
#include <arm_neon.h>

float32x4_t vf32x4Temp, vf32x4TempV1;
float32x4_t vf32x4Zero, vf32x4One;
int32x4_t vs32x4Temp;
uint32x4_t vu32x4TempV1;

vf32x4Zero = vdupq_n_f32(0.0f);
vf32x4One = vdupq_n_f32(1.0f);

#define STEP_NUM 4
for (i = 0; i < 10000 - STEP_NUM + 1; i += STEP_NUM) {	
    vf32x4Temp = vld1q_f32(&x[i]);
    vf32x4TempV1 = vf32x4Temp;
    vu32x4TempV1 = vcltq_f32(vf32x4Temp, vf32x4Zero); // åˆ¤æ–­æ˜¯å¦å°äº0
    vf32x4Temp = vbslq_f32(vu32x4TempV1, vsubq_f32(vf32x4Temp, vf32x4One), vf32x4Temp); // å¤§äº0ï¼Œåˆ™æˆªæ–­ï¼›å¦åˆ™ï¼Œå°±å‡1
    vs32x4Temp = vcvtq_s32_f32(vf32x4Temp); // æˆªæ–­å–æ•´ï¼Œä½†å­˜åœ¨å¦‚æœæ˜¯è´Ÿæ•°ä¸”ä¸ºæ•´æ•°æ—¶ï¼Œå¤šå‡äº†1
    vf32x4Temp = vcvtq_f32_s32(vs32x4Temp);
    vu32x4TempV1 = vcgeq_f32(vf32x4TempV1, vaddq_f32(vf32x4Temp, vf32x4One)); // a>=b+1 æ—¶ï¼Œå¤šå‡1çš„è´Ÿæ•°æ•´æ•°æœ¬èº«
    vf32x4Temp = vbslq_f32(vu32x4TempV1, vf32x4TempV1, vf32x4Temp); // å‡ºç°a>=b+1æƒ…å†µï¼Œå¿…ç„¶æ˜¯è´Ÿæ•°æ•´æ•°æœ¬èº«ï¼Œæ­¤æ—¶èµ‹å€¼ä¸ºåŸåˆå§‹å€¼
    vst1q_f32(&y[i], vf32x4Temp);
}
for (; i < 10000; i++) // å¤„ç†æ•°ç»„å°¾éƒ¨ä¸è¶³STEP_NUMçš„æ•°æ®
{
    y[i] = (float)floor(x[i]);
}
```

æ‰©å±•é˜…è¯»ï¼š[Cè¯­è¨€ï¼ˆC++ï¼‰ä¸­ï¼šè¯¦è§£floorå‡½æ•°ã€ceilå‡½æ•°å’Œroundå‡½æ•°](https://blog.csdn.net/dangzhangjing97/article/details/81279862)